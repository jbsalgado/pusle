<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Material de Constru√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configura√ß√£o din√¢mica ser√° aplicada via JavaScript
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#DC2626',
                        'primary-dark': '#B91C1C',
                        'primary-light': '#EF4444',
                        accent: '#F59E0B',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen relative overflow-hidden">
    <!-- Background Image -->
    <div id="background-image" class="fixed inset-0 -z-20 bg-cover bg-center bg-no-repeat opacity-50" style="background-image: url('imagens/logo/background.jpg');"></div>
    
    <!-- Overlay escuro para melhorar legibilidade -->
    <div class="fixed inset-0 -z-10 bg-gradient-to-br from-gray-900/30 via-gray-800/20 to-gray-900/30"></div>
    
    <!-- Bot√£o Entrar - Canto superior direito (discreto) -->
    <div class="fixed top-4 right-4 z-50">
        <a href="index.php/auth/login" 
           id="btn-entrar"
           class="inline-flex items-center gap-2 px-4 py-2 text-sm text-white/80 hover:text-white bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg hover:bg-white/20 transition-all duration-200 hover:border-white/30">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span class="hidden sm:inline">Entrar</span>
        </a>
    </div>
    
    <!-- Hero Section - Mobile First -->
    <div class="min-h-screen flex flex-col items-center justify-center px-4 py-8 sm:py-12 relative z-10">
        <div class="w-full max-w-md mx-auto text-center">
            <!-- Logo -->
            <div class="mb-8 sm:mb-12">
                <div class="inline-block p-4 bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl mb-4">
                    <img id="logo-empresa" 
                         src="imagens/logo/logo-01.png" 
                         alt="Logo" 
                         class="h-16 sm:h-20 w-auto mx-auto object-contain"
                         onerror="this.style.display='none'">
                </div>
                <h1 id="nome-loja" class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-2 drop-shadow-lg">
                    Material de Constru√ß√£o
                </h1>
                <p id="mensagem-boas-vindas" class="text-lg sm:text-xl text-white/90 drop-shadow-md">
                    Tudo para sua obra em um s√≥ lugar
                </p>
            </div>

            <!-- Main CTA Button - Cat√°logo em Destaque -->
            <div class="mb-8">
                <a href="catalogo/" 
                   id="btn-catalogo"
                   class="block w-full max-w-sm mx-auto bg-gradient-to-r from-primary to-primary-dark text-white py-6 sm:py-8 px-8 rounded-2xl font-bold text-xl sm:text-2xl shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-4">
                    <svg class="w-7 h-7 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                    </svg>
                    CAT√ÅLOGO DE PRODUTOS
                </a>
            </div>

            <!-- Features/Info Cards -->
            <div class="grid grid-cols-2 gap-3 sm:gap-4 mb-6 sm:mb-8">
                <div class="bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-md">
                    <div class="text-2xl sm:text-3xl mb-2">üèóÔ∏è</div>
                    <p class="text-xs sm:text-sm font-semibold text-gray-700">Materiais</p>
                    <p class="text-xs text-gray-500">Completos</p>
                </div>
                <div class="bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-md">
                    <div class="text-2xl sm:text-3xl mb-2">üöö</div>
                    <p class="text-xs sm:text-sm font-semibold text-gray-700">Entrega</p>
                    <p class="text-xs text-gray-500">R√°pida</p>
                </div>
                <div class="bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-md">
                    <div class="text-2xl sm:text-3xl mb-2">üí∞</div>
                    <p class="text-xs sm:text-sm font-semibold text-gray-700">Pre√ßos</p>
                    <p class="text-xs text-gray-500">Competitivos</p>
                </div>
                <div class="bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-md">
                    <div class="text-2xl sm:text-3xl mb-2">‚úÖ</div>
                    <p class="text-xs sm:text-sm font-semibold text-gray-700">Qualidade</p>
                    <p class="text-xs text-gray-500">Garantida</p>
                </div>
            </div>

            <!-- Footer Info -->
            <div id="footer-info" class="text-sm text-white/80 drop-shadow-md">
                <p>Atendimento de segunda a s√°bado</p>
                <p class="mt-1">Das 7h √†s 18h</p>
            </div>
        </div>
    </div>

    <script>
        // ID padr√£o da loja (mesmo usado no cat√°logo)
        const LOJA_ID = 'a99a38a9-e368-4a47-a4bd-02ba3bacaa76';
        
        // Detecta URL base da API
        function detectApiBaseUrl() {
            const pathname = window.location.pathname;
            
            // Remove barra final se existir
            let basePath = pathname.replace(/\/$/, '');
            
            // Se o path cont√©m index.php, extrai tudo at√© /index.php
            if (basePath.includes('/index.php')) {
                const match = basePath.match(/^(.+\/index\.php)/);
                if (match) {
                    basePath = match[1];
                } else {
                    const parts = basePath.split('/index.php');
                    basePath = parts[0] + '/index.php';
                }
            } else {
                // Se n√£o tem index.php, adiciona
                basePath = basePath.replace(/\/$/, '');
                if (!basePath || basePath === '/') {
                    basePath = '/index.php';
                } else {
                    basePath = basePath + '/index.php';
                }
            }
            
            // Garante que comece com /
            if (!basePath.startsWith('/')) {
                basePath = '/' + basePath;
            }
            
            return basePath;
        }
        
        const API_BASE = detectApiBaseUrl();
        
        // Carrega dados da empresa
        async function carregarDadosEmpresa() {
            try {
                const response = await fetch(`${API_BASE}/api/usuario/dados-loja?usuario_id=${LOJA_ID}`);
                
                if (!response.ok) {
                    console.warn('Erro ao carregar dados da empresa:', response.status);
                    return;
                }
                
                const dados = await response.json();
                
                if (dados.erro) {
                    console.warn('Erro na resposta:', dados.erro);
                    return;
                }
                
                // Aplica os dados na p√°gina
                aplicarDadosEmpresa(dados);
                
            } catch (error) {
                console.error('Erro ao carregar dados da empresa:', error);
            }
        }
        
        // Aplica os dados da empresa na p√°gina
        function aplicarDadosEmpresa(dados) {
            // Nome da loja
            if (dados.nome_loja) {
                document.getElementById('nome-loja').textContent = dados.nome_loja;
                document.getElementById('page-title').textContent = dados.nome_loja;
            }
            
            // Mensagem de boas-vindas
            if (dados.mensagem_boas_vindas) {
                document.getElementById('mensagem-boas-vindas').textContent = dados.mensagem_boas_vindas;
            }
            
            // Logo
            if (dados.logo_path) {
                const logoImg = document.getElementById('logo-empresa');
                let logoUrl = dados.logo_path;
                
                // Se n√£o for URL completa, adiciona caminho base
                if (!logoUrl.match(/^(https?:\/\/|\/)/)) {
                    const webBase = window.location.pathname.replace(/\/$/, '') || '/';
                    logoUrl = webBase + '/' + logoUrl.replace(/^\//, '');
                }
                
                logoImg.src = logoUrl;
                logoImg.style.display = 'block';
            }
            
            // Background image - s√≥ atualiza se houver uma imagem espec√≠fica configurada
            // Caso contr√°rio, mant√©m o background.jpg padr√£o definido no HTML
            const bgDiv = document.getElementById('background-image');
            
            // S√≥ substitui se houver um background_image espec√≠fico E diferente da logo
            if (dados.background_image && dados.background_image !== dados.logo_path) {
                let bgUrl = dados.background_image;
                
                // Se n√£o for URL completa, adiciona caminho base
                if (!bgUrl.match(/^(https?:\/\/|\/)/)) {
                    const webBase = window.location.pathname.replace(/\/$/, '') || '/';
                    bgUrl = webBase + '/' + bgUrl.replace(/^\//, '');
                }
                
                bgDiv.style.backgroundImage = `url('${bgUrl}')`;
                bgDiv.style.display = 'block';
            }
            // Se n√£o houver background_image espec√≠fico, mant√©m o background.jpg padr√£o
            
            // Cores personalizadas
            if (dados.cor_primaria) {
                const root = document.documentElement;
                root.style.setProperty('--color-primary', dados.cor_primaria);
                
                // Aplica cor prim√°ria nos bot√µes
                const btnCatalogo = document.getElementById('btn-catalogo');
                if (btnCatalogo) {
                    btnCatalogo.style.background = `linear-gradient(to right, ${dados.cor_primaria}, ${dados.cor_secundaria || dados.cor_primaria})`;
                }
                
                // Bot√£o entrar j√° est√° discreto no canto superior direito
                // N√£o precisa de ajustes de cor adicionais
            }
            
            // Informa√ß√µes de contato no footer
            const footerInfo = document.getElementById('footer-info');
            if (dados.telefone) {
                const telefoneFormatado = dados.telefone.replace(/\D/g, '').replace(/(\d{2})(\d{4,5})(\d{4})/, '($1) $2-$3');
                footerInfo.innerHTML = `
                    <p>${dados.telefone ? `üìû ${telefoneFormatado}` : ''}</p>
                    ${dados.endereco_completo ? `<p class="mt-1">üìç ${dados.endereco_completo}</p>` : ''}
                `;
            }
        }
        
        // Atualiza o href do bot√£o Entrar para usar o caminho base correto
        function atualizarBotaoEntrar() {
            const btnEntrar = document.getElementById('btn-entrar');
            if (btnEntrar) {
                const basePath = detectApiBaseUrl();
                btnEntrar.href = basePath.replace('/index.php', '') + '/index.php/auth/login';
            }
        }
        
        // Carrega dados ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            atualizarBotaoEntrar();
            carregarDadosEmpresa();
        });
    </script>
</body>
</html>